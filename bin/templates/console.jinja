<!--
    Copyright (C) 2015  Ryan M Cote.

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License along
    with this program; if not, write to the Free Software Foundation, Inc.,
    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

    Author: Ryan M Cote <minervaconsole@gmail.com>
-->
<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" type="image/png" href="/images/favicon.ico"/>
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="/css/minerva.css"/>
    <script src="/jquery.min.js"></script>
    <script src="/js/d3.v4.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/mustache.js"></script>
    <script src="/js/minerva.js"></script>
  </head>
    <title>Minerva {{title}} Console</title>
    <body>
    <script id="invAlertTemp" type="text/template" >
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="heading{{'{{index}}'}}">
          <h4 class="panel-title">
            <a role="button" data-toggle="collapse" data-parent="#invAlerts" href="#alert{{'{{index}}'}}" aria-expanded="true" aria-controls="alert{{'{{index}}'}}">
              <i class="more-less glyphicon glyphicon-plus"></i>
              {{'{{alert}}'}}
            </a>
          </h4>
        </div>
        <div id="alert{{'{{index}}'}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{'{{index}}'}}">
          <div class="panel-body">
            <h4>ASCII Alert Packet View</h4>
            <div>
              <p class="text-info minerva-break-word">{{'{{payload_printable}}'}}</p>
            </div>
            <hr>
            <h4>HEX Alert Packet View</h4>
            <div>
              <p class="text-info minerva-break-word">
              <pre>
              {{'{{#hex}}{{>hex}}{{/hex}}'}}
              </pre>
              </p>
            </div>
            <hr>
            <h4>Comments</h4>
              <p class="text-info">
              {{'{{#comments}}'}}
              <b>User:</b> {{'{{USER}}'}}<br />
              <b>Time:</b> {{'{{COMMENT_TIME}}'}}<br />
              <b>Comments:</b> {{'{{COMMENT}}'}}<br />
              <br>
              {{'{{/comments}}'}}
              </p>
            <hr>
          </div>
        </div>
      </div>
    </script>
    <script id="alertTemplate" type="text/template" >
      <div class="row minerva-alert {{'{{severity_class}}'}} sighash-{{'{{sig_hash}}'}} {{'{{#hidden}}hidden{{/hidden}}'}}" id="row{{'{{index}}'}}" data-uuids="{{'{{ids}}'}}" >
        <div class="row">
          <div class="col-md-2">
            <b>Timestamp: </b>{{'{{timestamp}}'}}
          </div>
          <div class="col-md-2">
            <b>Sensor: </b>{{'{{sensor}}'}}
          </div>
          <div class="col-md-1">
            <b>Severity: </b>{{'{{severity}}'}}
          </div>
          <div class="col-md-1 minerva-count" data-count={{'{{count}}'}}>
            <b>Count: </b>{{'{{count}}'}}
          </div>
          <div class="col-md-6 text-right minerva-chart-icons minerva-alert-icons">
            <a href="#" class="minerva-assign" data-toggle="tooltip" data-placement="left" title="Assign to me"><span class="glyphicon glyphicon-user"></span></a>
            <a href="#" class="minerva-investigate" data-toggle="tooltip" data-placement="left" title="More Details"><span class="glyphicon glyphicon-search"></span></a>
            <a href="#" class="minerva-pcap" data-toggle="tooltip" data-placement="left" title="Request PCAP"><span class="glyphicon glyphicon-download-alt"></span></a>
            <a href="#" class="minerva-escalate" data-toggle="tooltip" data-placement="left" title="Escalate"><span class="glyphicon glyphicon-circle-arrow-up"></span></a>
            <a href="#" class="minerva-close" data-toggle="tooltip" data-placement="left" title="Close"><span class="glyphicon glyphicon-remove"></span></a>
            <a href="#" class="minerva-comment" data-toggle="tooltip" data-placement="left" title="Comment"><span class="glyphicon glyphicon-comment"></span></a>
          </div>
        </div>
        <div class="row">
          <div class="col-md-2">
            <b>Src IP: </b>{{'{{src_ip}}'}}
          </div>
          <div class="col-md-2">
            <b>Src Port: </b>{{'{{src_port}}'}}
          </div>
          <div class="col-md-1">
            <b>Proto: </b>{{'{{proto}}'}}
          </div>
          <div class="col-md-7">
            <b>Signature: </b>{{'{{signature}}'}}
          </div>
        </div>
        <div class="row">
          <div class="col-md-2">
            <b>Dst IP: </b>{{'{{dest_ip}}'}}
          </div>
          <div class="col-md-2">
            <b>Dst Port: </b>{{'{{dest_port}}'}}
          </div>
          <div class="col-md-1"></div>
          <div class="col-md-5">
            <b>Category: </b>{{'{{category}}'}}
          </div>
          <div class="col-md-1">
            <b>SID: </b>{{'{{sid}}'}}
          </div>
          <div class="col-md-1">
            <b>Rev: </b>{{'{{rev}}'}}
          </div>
        </div>
      </div>
    </script>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="/">Minerva</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
            <li role="presentation" class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expand="true"><span class="glyphicon glyphicon-menu-hamburger"></span><span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  {% if 'console' in permissions %}<li {% if form == "console" %}class="active"{%endif%}><a href="/" class="submenu_left">Console</a></li>{% endif %}
                  {% if 'responder' in permissions %}<li {% if form == "responder" %}class="active"{%endif%}><a href="/responder" class="submenu_left">Escalated Events</a></li>{% endif %}
                  <li class="divider"></li>
                  {% if 'event_filters' in permissions %}
                  <li {% if form == "filters" %}class="active"{%endif%}><a href="/event_filters" class="submenu_left">Event Filters</a></li>
                  <li {% if form == "watchlist" %}class="active"{%endif%}><a href="/watchlist" class="submenu_left">Watchlist</a></li>
                  <li class="divider"></li>
                  {% endif %}
                  {#{%- if 'console' in permissions or 'responder' in permissions %}
                  <li {% if form == "flow" %}class="active"{% endif %}><a href="/flow">Session Flow</a></li>
                  <li {% if form == "alerts" %}class="active"{% endif %}><a href="/alerts">Search Alerts</a></li>
                  <li {% if form == "dns" %}class="active"{% endif %}><a href="/dns">Session DNS</a></li>
                  <li class="divider"></li>
                  {%- endif %}
                  {% if 'sensor_admin' in permissions %}
                  <li {% if form == "sensors" %}class="active"{%endif%}><a href="/sensors" class="submenu_left">Sensors</a></li>
                  <li {% if form == "signatures" %}class="active"{%endif%}><a href="/signatures" class="submenu_left">Signatures</a></li>
                  <li class="divider"></li>
                  {%- endif %}
                  {% if 'user_admin' in permissions %}<li {% if form == "usermanagement" %}class="active"{%endif%}><a href="/users" class="submenu_left">User Management</a></li>{% endif %}
                  {% if 'server_admin' in permissions %}
                  <li {% if form == "server_admin" %}class="active"{%endif%}><a href="/config" class="submenu_left">Server Admin</a></li>
                  {% endif %}#}
                  <li {% if form == "about" %}class="active"{%endif%}><a href="/about" class="submenu_left">About</a></li>
                  <li><a href="/logout" class="submenu_left">Logout</a></li>
                </ul>
            </li>
            </ul>
            {%- if 'console' in permissions or 'responder' in permissions %}
            <ul class="nav navbar-nav">
            <li role="presentation" class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expand="true"><span class="glyphicon glyphicon-search"></span></span><span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li {% if form == "flow" %}class="active"{% endif %}><a href="/flow">Session Flow</a></li>
                  <li {% if form == "alerts" %}class="active"{% endif %}><a href="/alerts">Search Alerts</a></li>
                  <li {% if form == "dns" %}class="active"{% endif %}><a href="/dns">Search DNS</a></li>
                </ul>
            </li>
            </ul>
            {%- endif %}
            <ul class="nav navbar-nav">
            <li role="presentation" class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expand="true"><span class="glyphicon glyphicon-cog"></span></span><span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  {% if 'sensor_admin' in permissions %}
                  <li {% if form == "sensors" %}class="active"{%endif%}><a href="/sensors" class="submenu_left">Sensors</a></li>
                  <li {% if form == "signatures" %}class="active"{%endif%}><a href="/signatures" class="submenu_left">Signatures</a></li>
                  {%- endif %}
                  {% if 'user_admin' in permissions %}<li {% if form == "usermanagement" %}class="active"{%endif%}><a href="/users" class="submenu_left">User Management</a></li>{% endif %}
                  {% if 'server_admin' in permissions %}
                  <li {% if form == "server_admin" %}class="active"{%endif%}><a href="/config" class="submenu_left">Server Admin</a></li>
                  {% endif %}
                  <li {% if form == "profile" %}class="active"{%endif%}><a href="/profile" class="submenu_left">Change Password</a></li>
                </ul>
            </li>
            </ul>
        </div>
      </div>
    </nav>
    <div class="container-fluid">
      <div id="investigateModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="Investigate Alert">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">Investigate Alert</h4>
            </div>
            <div id="investigateModalBody" class="modal-body">
              add investigate stuff here
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12 col-sm-12 minerva-panel">
          <div class="minerva-body">
            <div class="col-md-10">
              <input type=text class="minerva-search" />
            </div>
            <div class="col-md-2">
              <a href="#" class="btn btn-default" id="minerva-search">Search</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 col-sm-12 minerva-panel">
          <div class="minerva-header">
            <h4>Events</h4>
          </div>
          <div class="minerva-body" >
            <div class="minerva-alerts container-fluid" id="MinervaEvents">
              {% set severity_class = ["", "", "minerva-alert-low", "minerva-alert-medium", "minerva-alert-high", "minerva-alert-high"] %}
              {%- for item in results %}
              <div class="row minerva-alert {{severity_class[item.severity]}} sighash-{{item.sig_hash}}" id="row{{loop.index}}" data-uuids="{{item.ids}}" >
                <div class="row">
                  <div class="col-md-2">
                    <b>Timestamp: </b>{{item.timestamp}} {#.strftime('%Y-%m-%d %H:%M:%S')#}
                  </div>
                  <div class="col-md-2">
                    <b>Sensor: </b>{{item.sensor}}
                  </div>
                  <div class="col-md-1">
                    <b>Severity: </b>{{item.severity}}
                  </div>
                  <div class="col-md-1 minerva-count" data-count={{item.count}}>
                    <b>Count: </b>{{item.count}}
                  </div>
                  <div class="col-md-6 text-right minerva-chart-icons minerva-alert-icons">
                    <a href="#" class="minerva-assign" data-toggle="tooltip" data-placement="left" title="Assign to me"><span class="glyphicon glyphicon-user"></span></a>
                    <a href="#" class="minerva-investigate" data-toggle="tooltip" data-placement="left" title="More Details"><span class="glyphicon glyphicon-search"></span></a>
                    <a href="#" class="minerva-pcap" data-toggle="tooltip" data-placement="left" title="Request PCAP"><span class="glyphicon glyphicon-download-alt"></span></a>
                    <a href="#" class="minerva-escalate" data-toggle="tooltip" data-placement="left" title="Escalate"><span class="glyphicon glyphicon-circle-arrow-up"></span></a>
                    <a href="#" class="minerva-close" data-toggle="tooltip" data-placement="left" title="Close"><span class="glyphicon glyphicon-remove"></span></a>
                    <a href="#" class="minerva-comment" data-toggle="tooltip" data-placement="left" title="Comment"><span class="glyphicon glyphicon-comment"></span></a>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-2">
                    <b>Src IP: </b>{{item.src_ip}}
                  </div>
                  <div class="col-md-2">
                    <b>Src Port: </b>{{item.src_port}}
                  </div>
                  <div class="col-md-1">
                    <b>Proto: </b>{{item.proto}}
                  </div>
                  <div class="col-md-7">
                    <b>Signature: </b>{{item.signature}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-2">
                    <b>Dst IP: </b>{{item.dest_ip}}
                  </div>
                  <div class="col-md-2">
                    <b>Dst Port: </b>{{item.dest_port}}
                  </div>
                  <div class="col-md-1"></div>
                  <div class="col-md-5">
                    <b>Category: </b>{{item.category}}
                  </div>
                  <div class="col-md-1">
                    <b>SID: </b>{{item.sid}}
                  </div>
                  <div class="col-md-1">
                    <b>Rev: </b>{{item.rev}}
                  </div>
                </div>
              </div>
              {%- endfor %}
            </div>
          </div>
          <div class="minerva-footer">
            <div class="col-md-6 text-left">
              <nav aria-label="Page navigation">
                <ul class="pagination minerva-table-size" id="PageSizer">
                  <li class="active" data-value=5><span>5<span class="sr-only">(current)</span></span></li>
                  <li class="minerva-psize" data-value=15><a href="#">15</a></li>
                  <li class="minerva-psize" data-value=25><a href="#">25</a></li>
                  <li class="minerva-psize" data-value="all"><a href="#">all</a></li>
                </ul>
              </nav>
            </div>
            <div class="col-md-6 text-right">
              <nav aria-label="Page navigation minerva-table-page">
                <ul class="pagination" id="EventPager">
                  <li>
                    <a href="#" aria-label="Previous" data-value="prev" class="minerva-pager">
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                  <li class="active" data-value=1><span>1<span class="sr-only">(current)</span></span></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div id="ip_count" class="col-md-4 col-sm-4 minerva-panel">
          <div class="minerva-header">
            <div class="row">
              <div class="col-md-4">
                <h4>IPs By Frequency</h4>
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-4 text-right minerva-chart-icons">
                <a href="#ip_count" class="minerva-pie-btn" data-toggle="tooltip" data-placement="left" title="Pie Chart"><span class="glyphicon glyphicon-adjust text-right"></span></a>
                <a href="#ip_count" class="minerva-bar-btn" data-toggle="tooltip" data-placement="left" title="Bar Chart"><span class="glyphicon glyphicon-align-left text-right"></span></a>
                <a href="#ip_count" class="minerva-tab-btn" data-toggle="tooltip" data-placement="left" title="Table"><span class="glyphicon glyphicon-align-justify text-right"></span></a>
                <a href="#ip_count" class="minerva-ref-btn" data-toggle="tooltip" data-placement="left" title="Refresh"><span class="glyphicon glyphicon-refresh text-right"></span></a>
              </div>
            </div>
          </div>
          <div class="minerva-body">
            <div class="minerva-bar">
              INSERT SVG HERE
            </div>
            <div class="minerva-pie hidden">
              INSERT SVG HERE
            </div>
            <div class="minerva-table hidden">
              INSERT table here
            </div>
          </div>
          <div class="minerva-footer">
            Some import description
          </div>
        </div>
        <div id="ip_bytes" class="col-md-4 col-sm-4 minerva-panel">
          <div class="minerva-header">
            <div class="row">
              <div class="col-md-4">
                <h4>IP by volume</h4>
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-4 text-right minerva-chart-icons">
                <a href="#ip_bytes" class="minerva-pie-btn" data-toggle="tooltip" data-placement="left" title="Pie Chart"><span class="glyphicon glyphicon-adjust text-right"></span></a>
                <a href="#ip_bytes" class="minerva-bar-btn" data-toggle="tooltip" data-placement="left" title="Bar Chart"><span class="glyphicon glyphicon-align-left text-right"></span></a>
                <a href="#ip_bytes" class="minerva-tab-btn" data-toggle="tooltip" data-placement="left" title="Table"><span class="glyphicon glyphicon-align-justify text-right"></span></a>
                <a href="#ip_bytes" class="minerva-ref-btn" data-toggle="tooltip" data-placement="left" title="Refresh"><span class="glyphicon glyphicon-refresh text-right"></span></a>
              </div>
            </div>
          </div>
          <div class="minerva-body">
            <div class="minerva-bar">
              INSERT SVG HERE
            </div>
            <div class="minerva-pie hidden">
              INSERT SVG HERE
            </div>
            <div class="minerva-table hidden">
              INSERT table here
            </div>
          </div>
          <div class="minerva-footer">
            Some import description
          </div>
        </div>
        <div id="dns_count" class="col-md-4 col-sm-4 minerva-panel">
          <div class="minerva-header">
            <div class="row">
              <div class="col-md-4">
                <h4>DNS by Count</h4>
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-4 text-right minerva-chart-icons">
                <a href="#dns_count" class="minerva-pie-btn" data-toggle="tooltip" data-placement="left" title="Pie Chart"><span class="glyphicon glyphicon-adjust text-right"></span></a>
                <a href="#dns_count" class="minerva-bar-btn" data-toggle="tooltip" data-placement="left" title="Bar Chart"><span class="glyphicon glyphicon-align-left text-right"></span></a>
                <a href="#dns_count" class="minerva-tab-btn" data-toggle="tooltip" data-placement="left" title="Table"><span class="glyphicon glyphicon-align-justify text-right"></span></a>
                <a href="#dns_count" class="minerva-ref-btn" data-toggle="tooltip" data-placement="left" title="Refresh"><span class="glyphicon glyphicon-refresh text-right"></span></a>
              </div>
            </div>
          </div>
          <div class="minerva-body">
            <div class="minerva-bar">
              INSERT SVG HERE
            </div>
            <div class="minerva-pie hidden">
              INSERT SVG HERE
            </div>
            <div class="minerva-table hidden">
              INSERT table here
            </div>
          </div>
          <div class="minerva-footer">
            Some import description
          </div>
        </div>
      </div>
      <div class="row">
        <div id="http_count" class="col-md-4 col-sm-4 minerva-panel">
          <div class="minerva-header">
            <div class="row">
              <div class="col-md-4">
                <h4>Top HTTP Hosts visited</h4>
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-4 text-right minerva-chart-icons">
                <a href="#http_count" class="minerva-pie-btn" data-toggle="tooltip" data-placement="left" title="Pie Chart"><span class="glyphicon glyphicon-adjust text-right"></span></a>
                <a href="#http_count" class="minerva-bar-btn" data-toggle="tooltip" data-placement="left" title="Bar Chart"><span class="glyphicon glyphicon-align-left text-right"></span></a>
                <a href="#http_count" class="minerva-tab-btn" data-toggle="tooltip" data-placement="left" title="Table"><span class="glyphicon glyphicon-align-justify text-right"></span></a>
                <a href="#http_count" class="minerva-ref-btn" data-toggle="tooltip" data-placement="left" title="Refresh"><span class="glyphicon glyphicon-refresh text-right"></span></a>
              </div>
            </div>
          </div>
          <div class="minerva-body">
            <div class="minerva-bar">
              INSERT SVG HERE
            </div>
            <div class="minerva-pie hidden">
              INSERT SVG HERE
            </div>
            <div class="minerva-table hidden">
              INSERT table here
            </div>
          </div>
          <div class="minerva-footer">
            Some import description
          </div>
        </div>
        <div id="sensor_vol" class="col-md-4 col-sm-4 minerva-panel">
          <div class="minerva-header">
            <div class="row">
              <div class="col-md-4">
                <h4>Sensor Volume</h4>
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-4 text-right minerva-chart-icons">
                <a href="#sensor_vol" class="minerva-pie-btn" data-toggle="tooltip" data-placement="left" title="Pie Chart"><span class="glyphicon glyphicon-adjust text-right"></span></a>
                <a href="#sensor_vol" class="minerva-bar-btn" data-toggle="tooltip" data-placement="left" title="Bar Chart"><span class="glyphicon glyphicon-align-left text-right"></span></a>
                <a href="#sensor_vol" class="minerva-tab-btn" data-toggle="tooltip" data-placement="left" title="Table"><span class="glyphicon glyphicon-align-justify text-right"></span></a>
                <a href="#sensor_vol" class="minerva-ref-btn" data-toggle="tooltip" data-placement="left" title="Refresh"><span class="glyphicon glyphicon-refresh text-right"></span></a>
              </div>
            </div>
          </div>
          <div class="minerva-body">
            <div class="minerva-bar">
              INSERT SVG HERE
            </div>
            <div class="minerva-pie hidden">
              INSERT SVG HERE
            </div>
            <div class="minerva-table hidden">
              INSERT table here
            </div>
          </div>
          <div class="minerva-footer">
            Some import description
          </div>
        </div>
        <div id="case_stats" class="col-md-4 col-sm-4 minerva-panel">
          <div class="minerva-header">
            <div class="row">
              <div class="col-md-4">
                <h4>Case Stats</h4>
              </div>
              <div class="col-md-4"></div>
              <div class="col-md-4 text-right minerva-chart-icons">
                <a href="#case_stats" class="minerva-pie-btn" data-toggle="tooltip" data-placement="left" title="Pie Chart"><span class="glyphicon glyphicon-adjust text-right"></span></a>
                <a href="#case_stats" class="minerva-bar-btn" data-toggle="tooltip" data-placement="left" title="Bar Chart"><span class="glyphicon glyphicon-align-left text-right"></span></a>
                <a href="#case_stats" class="minerva-tab-btn" data-toggle="tooltip" data-placement="left" title="Table"><span class="glyphicon glyphicon-align-justify text-right"></span></a>
                <a href="#case_stats" class="minerva-ref-btn" data-toggle="tooltip" data-placement="left" title="Refresh"><span class="glyphicon glyphicon-refresh text-right"></span></a>
              </div>
            </div>
          </div>
          <div class="minerva-body">
            <div class="minerva-bar">
              INSERT SVG HERE
            </div>
            <div class="minerva-pie hidden">
              INSERT SVG HERE
            </div>
            <div class="minerva-table hidden">
              INSERT table here
            </div>
          </div>
          <div class="minerva-footer">
            Some import description
          </div>
        </div>
      </div>
    </div>
    <!-- tokens -->
    <input type="hidden" id="form_type" value="{{form}}"></input>
    <input type="hidden" id="minerva_token" value="{{session_id}}"></input>
    <!-- include deferred scripts here -->
  </body>
</html>

